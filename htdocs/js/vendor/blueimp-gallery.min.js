(function(e){"function"===typeof define&&define.amd?define(["./blueimp-helper"],e):(window.blueimp=window.blueimp||{},window.blueimp.Gallery=e(window.blueimp.helper||window.jQuery))})(function(e){function h(a,b){if(void 0===document.body.style.maxHeight)return null;if(!this||this.options!==h.prototype.options)return new h(a,b);a&&a.length?(this.list=a,this.num=a.length,this.initOptions(b),this.initialize()):this.console.log("blueimp Gallery: No or empty list provided as first argument.",a)}e.extend(h.prototype,
{options:{container:"#blueimp-gallery",slidesContainer:"div",titleElement:"h3",displayClass:"blueimp-gallery-display",controlsClass:"blueimp-gallery-controls",singleClass:"blueimp-gallery-single",leftEdgeClass:"blueimp-gallery-left",rightEdgeClass:"blueimp-gallery-right",playingClass:"blueimp-gallery-playing",slideClass:"slide",slideLoadingClass:"slide-loading",slideErrorClass:"slide-error",slideContentClass:"slide-content",toggleClass:"toggle",prevClass:"prev",nextClass:"next",closeClass:"close",
playPauseClass:"play-pause",typeProperty:"type",titleProperty:"title",urlProperty:"href",displayTransition:!0,clearSlides:!0,stretchImages:!1,toggleControlsOnReturn:!0,toggleSlideshowOnSpace:!0,enableKeyboardNavigation:!0,closeOnEscape:!0,closeOnSlideClick:!0,closeOnSwipeUpOrDown:!0,emulateTouchEvents:!0,stopTouchEventsPropagation:!1,hidePageScrollbars:!0,disableScroll:!0,carousel:!1,continuous:!0,unloadElements:!0,startSlideshow:!1,slideshowInterval:5E3,index:0,preloadRange:2,transitionSpeed:400,
slideshowTransitionSpeed:void 0,event:void 0,onopen:void 0,onopened:void 0,onslide:void 0,onslideend:void 0,onslidecomplete:void 0,onclose:void 0,onclosed:void 0},carouselOptions:{hidePageScrollbars:!1,toggleControlsOnReturn:!1,toggleSlideshowOnSpace:!1,enableKeyboardNavigation:!1,closeOnEscape:!1,closeOnSlideClick:!1,closeOnSwipeUpOrDown:!1,disableScroll:!1,startSlideshow:!0},console:window.console&&"function"===typeof window.console.log?window.console:{log:function(){}},support:function(a){var b=
{touch:void 0!==window.ontouchstart||window.DocumentTouch&&document instanceof DocumentTouch},c=function(){var c=b.transition,f,g;document.body.appendChild(a);c&&(f=c.name.slice(0,-9)+"ransform",void 0!==a.style[f]&&(a.style[f]="translateZ(0)",g=window.getComputedStyle(a).getPropertyValue(c.prefix+"transform"),b.transform={prefix:c.prefix,name:f,translate:!0,translateZ:!!g&&"none"!==g}));void 0!==a.style.backgroundSize&&(b.backgroundSize={},a.style.backgroundSize="contain",b.backgroundSize.contain=
"contain"===window.getComputedStyle(a).getPropertyValue("background-size"),a.style.backgroundSize="cover",b.backgroundSize.cover="cover"===window.getComputedStyle(a).getPropertyValue("background-size"));document.body.removeChild(a)};(function(b,c){for(var g in c)if(c.hasOwnProperty(g)&&void 0!==a.style[g]){b.transition=c[g];b.transition.name=g;break}})(b,{webkitTransition:{end:"webkitTransitionEnd",prefix:"-webkit-"},MozTransition:{end:"transitionend",prefix:"-moz-"},OTransition:{end:"otransitionend",
prefix:"-o-"},transition:{end:"transitionend",prefix:""}});if(document.body)c();else e(document).on("DOMContentLoaded",c);return b}(document.createElement("div")),requestAnimationFrame:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,initialize:function(){this.initStartIndex();if(!1===this.initWidget())return!1;this.initEventListeners();this.onslide(this.index);this.ontransitionend();this.options.startSlideshow&&this.play()},slide:function(a,b){window.clearTimeout(this.timeout);
var c=this.index,d,f;if(c!==a&&1!==this.num){b||(b=this.options.transitionSpeed);if(this.support.transform){this.options.continuous||(a=this.circle(a));d=Math.abs(c-a)/(c-a);this.options.continuous&&(f=d,d=-this.positions[this.circle(a)]/this.slideWidth,d!==f&&(a=-d*this.num+a));for(f=Math.abs(c-a)-1;f;)f-=1,this.move(this.circle((a>c?a:c)-f-1),this.slideWidth*d,0);a=this.circle(a);this.move(c,this.slideWidth*d,b);this.move(a,0,b);this.options.continuous&&this.move(this.circle(a-d),-(this.slideWidth*
d),0)}else a=this.circle(a),this.animate(c*-this.slideWidth,a*-this.slideWidth,b);this.onslide(a)}},getIndex:function(){return this.index},getNumber:function(){return this.num},prev:function(){(this.options.continuous||this.index)&&this.slide(this.index-1)},next:function(){(this.options.continuous||this.index<this.num-1)&&this.slide(this.index+1)},play:function(a){var b=this;window.clearTimeout(this.timeout);this.interval=a||this.options.slideshowInterval;1<this.elements[this.index]&&(this.timeout=
this.setTimeout(!this.requestAnimationFrame&&this.slide||function(a,d){b.animationFrameId=b.requestAnimationFrame.call(window,function(){b.slide(a,d)})},[this.index+1,this.options.slideshowTransitionSpeed],this.interval));this.container.addClass(this.options.playingClass)},pause:function(){window.clearTimeout(this.timeout);this.interval=null;this.container.removeClass(this.options.playingClass)},add:function(a){a.concat||(a=Array.prototype.slice.call(a));this.list.concat||(this.list=Array.prototype.slice.call(this.list));
this.list=this.list.concat(a);this.num=this.list.length;2<this.num&&null===this.options.continuous&&(this.options.continuous=!0,this.container.removeClass(this.options.leftEdgeClass));this.container.removeClass(this.options.rightEdgeClass).removeClass(this.options.singleClass);for(a=this.num-a.length;a<this.num;a+=1)this.addSlide(a),this.positionSlide(a);this.positions.length=this.num;this.initSlides(!0)},resetSlides:function(){this.slidesContainer.empty();this.unloadAllSlides();this.slides=[]},handleClose:function(){var a=
this.options;this.destroyEventListeners();this.pause();this.container[0].style.display="none";this.container.removeClass(a.displayClass).removeClass(a.singleClass).removeClass(a.leftEdgeClass).removeClass(a.rightEdgeClass);a.hidePageScrollbars&&(document.body.style.overflow=this.bodyOverflowStyle);this.options.clearSlides&&this.resetSlides();this.options.onclosed&&this.options.onclosed.call(this)},close:function(){var a=this,b=function(c){c.target===a.container[0]&&(a.container.off(a.support.transition.end,
b),a.handleClose())};this.options.onclose&&this.options.onclose.call(this);this.support.transition&&this.options.displayTransition?(this.container.on(this.support.transition.end,b),this.container.removeClass(this.options.displayClass)):this.handleClose()},circle:function(a){return(this.num+a%this.num)%this.num},move:function(a,b,c){this.translateX(a,b,c);this.positions[a]=b},translate:function(a,b,c,d){a=this.slides[a].style;var f=this.support.transform;a[this.support.transition.name+"Duration"]=
d+"ms";a[f.name]="translate("+b+"px, "+c+"px)"+(f.translateZ?" translateZ(0)":"")},translateX:function(a,b,c){this.translate(a,b,0,c)},translateY:function(a,b,c){this.translate(a,0,b,c)},animate:function(a,b,c){if(c)var d=this,f=(new Date).getTime(),g=window.setInterval(function(){var e=(new Date).getTime()-f;e>c?(d.slidesContainer[0].style.left=b+"px",d.ontransitionend(),window.clearInterval(g)):d.slidesContainer[0].style.left=Math.floor(e/c*100)/100*(b-a)+a+"px"},4);else this.slidesContainer[0].style.left=
b+"px"},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},onresize:function(){this.initSlides(!0)},onmousedown:function(a){a.which&&1===a.which&&"VIDEO"!==a.target.nodeName&&(a.preventDefault(),(a.originalEvent||a).touches=[{pageX:a.pageX,pageY:a.pageY}],this.ontouchstart(a))},onmousemove:function(a){this.touchStart&&((a.originalEvent||a).touches=[{pageX:a.pageX,pageY:a.pageY}],this.ontouchmove(a))},
onmouseup:function(a){this.touchStart&&(this.ontouchend(a),delete this.touchStart)},onmouseout:function(a){if(this.touchStart){var b=a.target,c=a.relatedTarget;if(!c||c!==b&&!e.contains(b,c))this.onmouseup(a)}},ontouchstart:function(a){this.options.stopTouchEventsPropagation&&this.stopPropagation(a);a=(a.originalEvent||a).touches[0];this.touchStart={x:a.pageX,y:a.pageY,time:Date.now()};this.isScrolling=void 0;this.touchDelta={}},ontouchmove:function(a){this.options.stopTouchEventsPropagation&&this.stopPropagation(a);
var b=(a.originalEvent||a).touches[0],c=(a.originalEvent||a).scale,d=this.index;if(!(1<b.length||c&&1!==c))if(this.options.disableScroll&&a.preventDefault(),this.touchDelta={x:b.pageX-this.touchStart.x,y:b.pageY-this.touchStart.y},b=this.touchDelta.x,void 0===this.isScrolling&&(this.isScrolling=this.isScrolling||Math.abs(b)<Math.abs(this.touchDelta.y)),this.isScrolling)this.options.closeOnSwipeUpOrDown&&this.translateY(d,this.touchDelta.y+this.positions[d],0);else for(a.preventDefault(),window.clearTimeout(this.timeout),
this.options.continuous?a=[this.circle(d+1),d,this.circle(d-1)]:(this.touchDelta.x=b/=!d&&0<b||d===this.num-1&&0>b?Math.abs(b)/this.slideWidth+1:1,a=[d],d&&a.push(d-1),d<this.num-1&&a.unshift(d+1));a.length;)d=a.pop(),this.translateX(d,b+this.positions[d],0)},ontouchend:function(a){this.options.stopTouchEventsPropagation&&this.stopPropagation(a);a=this.index;var b=this.options.transitionSpeed,c=this.slideWidth,d=250>Number(Date.now()-this.touchStart.time),f=d&&20<Math.abs(this.touchDelta.x)||Math.abs(this.touchDelta.x)>
c/2,g=!a&&0<this.touchDelta.x||a===this.num-1&&0>this.touchDelta.x,e=!f&&this.options.closeOnSwipeUpOrDown&&(d&&20<Math.abs(this.touchDelta.y)||Math.abs(this.touchDelta.y)>this.slideHeight/2);this.options.continuous&&(g=!1);d=0>this.touchDelta.x?-1:1;this.isScrolling?e?this.close():this.translateY(a,0,b):f&&!g?(f=a+d,g=a-d,e=c*d,c=-c*d,this.options.continuous?(this.move(this.circle(f),e,0),this.move(this.circle(a-2*d),c,0)):0<=f&&f<this.num&&this.move(f,e,0),this.move(a,this.positions[a]+e,b),this.move(this.circle(g),
this.positions[this.circle(g)]+e,b),a=this.circle(g),this.onslide(a)):this.options.continuous?(this.move(this.circle(a-1),-c,b),this.move(a,0,b),this.move(this.circle(a+1),c,b)):(a&&this.move(a-1,-c,b),this.move(a,0,b),a<this.num-1&&this.move(a+1,c,b))},ontouchcancel:function(a){this.touchStart&&(this.ontouchend(a),delete this.touchStart)},ontransitionend:function(a){var b=this.slides[this.index];a&&b!==a.target||(this.interval&&this.play(),this.setTimeout(this.options.onslideend,[this.index,b]))},
oncomplete:function(a){var b=a.target||a.srcElement,c=b&&b.parentNode,d;b&&c&&(d=this.getNodeIndex(c),e(c).removeClass(this.options.slideLoadingClass),"error"===a.type?(e(c).addClass(this.options.slideErrorClass),this.elements[d]=3):this.elements[d]=2,b.clientHeight>this.container[0].clientHeight&&(b.style.maxHeight=this.container[0].clientHeight),this.interval&&this.slides[this.index]===c&&this.play(),this.setTimeout(this.options.onslidecomplete,[d,c]))},onload:function(a){this.oncomplete(a)},onerror:function(a){this.oncomplete(a)},
onkeydown:function(a){switch(a.which||a.keyCode){case 13:this.options.toggleControlsOnReturn&&(this.preventDefault(a),this.toggleControls());break;case 27:this.options.closeOnEscape&&(this.close(),a.stopImmediatePropagation());break;case 32:this.options.toggleSlideshowOnSpace&&(this.preventDefault(a),this.toggleSlideshow());break;case 37:this.options.enableKeyboardNavigation&&(this.preventDefault(a),this.prev());break;case 39:this.options.enableKeyboardNavigation&&(this.preventDefault(a),this.next())}},
handleClick:function(a){var b=this.options,c=a.target||a.srcElement,d=c.parentNode,f=function(a){return e(c).hasClass(a)||e(d).hasClass(a)};f(b.toggleClass)?(this.preventDefault(a),this.toggleControls()):f(b.prevClass)?(this.preventDefault(a),this.prev()):f(b.nextClass)?(this.preventDefault(a),this.next()):f(b.closeClass)?(this.preventDefault(a),this.close()):f(b.playPauseClass)?(this.preventDefault(a),this.toggleSlideshow()):d===this.slidesContainer[0]?(this.preventDefault(a),b.closeOnSlideClick?
this.close():this.toggleControls()):d.parentNode&&d.parentNode===this.slidesContainer[0]&&(this.preventDefault(a),this.toggleControls())},onclick:function(a){if(this.options.emulateTouchEvents&&this.touchDelta&&(20<Math.abs(this.touchDelta.x)||20<Math.abs(this.touchDelta.y)))delete this.touchDelta;else return this.handleClick(a)},updateEdgeClasses:function(a){a?this.container.removeClass(this.options.leftEdgeClass):this.container.addClass(this.options.leftEdgeClass);a===this.num-1?this.container.addClass(this.options.rightEdgeClass):
this.container.removeClass(this.options.rightEdgeClass)},handleSlide:function(a){this.options.continuous||this.updateEdgeClasses(a);this.loadElements(a);this.options.unloadElements&&this.unloadElements(a);this.setTitle(a)},onslide:function(a){this.index=a;this.handleSlide(a);this.setTimeout(this.options.onslide,[a,this.slides[a]])},setTitle:function(a){a=this.slides[a].firstChild.title;var b=this.titleElement;b.length&&(this.titleElement.empty(),a&&b[0].appendChild(document.createTextNode(a)))},setTimeout:function(a,
b,c){var d=this;return a&&window.setTimeout(function(){a.apply(d,b||[])},c||0)},imageFactory:function(a,b){var c=this,d=this.imagePrototype.cloneNode(!1),f=a,g=this.options.stretchImages,h,k,l=function(a){if(!h){a={type:a.type,target:k};if(!k.parentNode)return c.setTimeout(l,[a]);h=!0;e(d).off("load error",l);g&&"load"===a.type&&(k.style.background='url("'+f+'") center no-repeat',k.style.backgroundSize=g);b(a)}},m;"string"!==typeof f&&(f=this.getItemProperty(a,this.options.urlProperty),m=this.getItemProperty(a,
this.options.titleProperty));!0===g&&(g="contain");(g=this.support.backgroundSize&&this.support.backgroundSize[g]&&g)?k=this.elementPrototype.cloneNode(!1):(k=d,d.draggable=!1);m&&(k.title=m);e(d).on("load error",l);d.src=f;return k},createElement:function(a,b){var c=a&&this.getItemProperty(a,this.options.typeProperty),c=c&&this[c.split("/")[0]+"Factory"]||this.imageFactory,c=a&&c.call(this,a,b);c||(c=this.elementPrototype.cloneNode(!1),this.setTimeout(b,[{type:"error",target:c}]));e(c).addClass(this.options.slideContentClass);
return c},loadElement:function(a){this.elements[a]||(this.slides[a].firstChild?this.elements[a]=e(this.slides[a]).hasClass(this.options.slideErrorClass)?3:2:(this.elements[a]=1,e(this.slides[a]).addClass(this.options.slideLoadingClass),this.slides[a].appendChild(this.createElement(this.list[a],this.proxyListener))))},loadElements:function(a){var b=Math.min(this.num,2*this.options.preloadRange+1),c;for(c=0;c<b;c+=1)a+=c*(0===c%2?-1:1),a=this.circle(a),this.loadElement(a)},unloadElements:function(a){var b,
c;for(b in this.elements)this.elements.hasOwnProperty(b)&&(c=Math.abs(a-b),c>this.options.preloadRange&&c+this.options.preloadRange<this.num&&(this.unloadSlide(b),delete this.elements[b]))},addSlide:function(a){var b=this.slidePrototype.cloneNode(!1);b.setAttribute("data-index",a);this.slidesContainer[0].appendChild(b);this.slides.push(b)},positionSlide:function(a){var b=this.slides[a];b.style.width=this.slideWidth+"px";this.support.transform&&(b.style.left=a*-this.slideWidth+"px",this.move(a,this.index>
a?-this.slideWidth:this.index<a?this.slideWidth:0,0))},initSlides:function(a){var b;a||(this.positions=[],this.positions.length=this.num,this.elements={},this.imagePrototype=document.createElement("img"),this.elementPrototype=document.createElement("div"),this.slidePrototype=document.createElement("div"),e(this.slidePrototype).addClass(this.options.slideClass),this.slides=this.slidesContainer[0].children,b=this.options.clearSlides||this.slides.length!==this.num);this.slideWidth=this.container[0].offsetWidth;
this.slideHeight=this.container[0].offsetHeight;this.slidesContainer[0].style.width=this.num*this.slideWidth+"px";b&&this.resetSlides();for(a=0;a<this.num;a+=1)b&&this.addSlide(a),this.positionSlide(a);this.options.continuous&&this.support.transform&&(this.move(this.circle(this.index-1),-this.slideWidth,0),this.move(this.circle(this.index+1),this.slideWidth,0));this.support.transform||(this.slidesContainer[0].style.left=this.index*-this.slideWidth+"px")},unloadSlide:function(a){var b;a=this.slides[a];
b=a.firstChild;null!==b&&a.removeChild(b)},unloadAllSlides:function(){var a,b;a=0;for(b=this.slides.length;a<b;a++)this.unloadSlide(a)},toggleControls:function(){var a=this.options.controlsClass;this.container.hasClass(a)?this.container.removeClass(a):this.container.addClass(a)},toggleSlideshow:function(){this.interval?this.pause():this.play()},getNodeIndex:function(a){return parseInt(a.getAttribute("data-index"),10)},getNestedProperty:function(a,b){b.replace(/\[(?:'([^']+)'|"([^"]+)"|(\d+))\]|(?:(?:^|\.)([^\.\[]+))/g,
function(b,d,f,e,h){d=h||d||f||e&&parseInt(e,10);b&&a&&(a=a[d])});return a},getDataProperty:function(a,b){if(a.getAttribute){var c=a.getAttribute("data-"+b.replace(/([A-Z])/g,"-$1").toLowerCase());if("string"===typeof c){if(/^(true|false|null|-?\d+(\.\d+)?|\{[\s\S]*\}|\[[\s\S]*\])$/.test(c))try{return e.parseJSON(c)}catch(d){}return c}}},getItemProperty:function(a,b){var c=a[b];void 0===c&&(c=this.getDataProperty(a,b),void 0===c&&(c=this.getNestedProperty(a,b)));return c},initStartIndex:function(){var a=
this.options.index,b=this.options.urlProperty,c;if(a&&"number"!==typeof a)for(c=0;c<this.num;c+=1)if(this.list[c]===a||this.getItemProperty(this.list[c],b)===this.getItemProperty(a,b)){a=c;break}this.index=this.circle(parseInt(a,10)||0)},initEventListeners:function(){var a=this,b=this.slidesContainer,c=function(b){a["on"+(a.support.transition&&a.support.transition.end===b.type?"transitionend":b.type)](b)};e(window).on("resize",c);e(document.body).on("keydown",c);this.container.on("click",c);if(this.support.touch)b.on("touchstart touchmove touchend touchcancel",
c);else if(this.options.emulateTouchEvents&&this.support.transition)b.on("mousedown mousemove mouseup mouseout",c);if(this.support.transition)b.on(this.support.transition.end,c);this.proxyListener=c},destroyEventListeners:function(){var a=this.slidesContainer,b=this.proxyListener;e(window).off("resize",b);e(document.body).off("keydown",b);this.container.off("click",b);this.support.touch?a.off("touchstart touchmove touchend touchcancel",b):this.options.emulateTouchEvents&&this.support.transition&&
a.off("mousedown mousemove mouseup mouseout",b);this.support.transition&&a.off(this.support.transition.end,b)},handleOpen:function(){this.options.onopened&&this.options.onopened.call(this)},initWidget:function(){var a=this,b=function(c){c.target===a.container[0]&&(a.container.off(a.support.transition.end,b),a.handleOpen())};this.container=e(this.options.container);if(!this.container.length)return this.console.log("blueimp Gallery: Widget container not found.",this.options.container),!1;this.slidesContainer=
this.container.find(this.options.slidesContainer).first();if(!this.slidesContainer.length)return this.console.log("blueimp Gallery: Slides container not found.",this.options.slidesContainer),!1;this.titleElement=this.container.find(this.options.titleElement).first();1===this.num&&this.container.addClass(this.options.singleClass);this.options.onopen&&this.options.onopen.call(this);if(this.support.transition&&this.options.displayTransition)this.container.on(this.support.transition.end,b);else this.handleOpen();
this.options.hidePageScrollbars&&(this.bodyOverflowStyle=document.body.style.overflow,document.body.style.overflow="hidden");this.container[0].style.display="block";this.initSlides();this.container.addClass(this.options.displayClass)},initOptions:function(a){this.options=e.extend({},this.options);(a&&a.carousel||this.options.carousel&&(!a||!1!==a.carousel))&&e.extend(this.options,this.carouselOptions);e.extend(this.options,a);3>this.num&&(this.options.continuous=this.options.continuous?null:!1);this.support.transition||
(this.options.emulateTouchEvents=!1);this.options.event&&this.preventDefault(this.options.event)}});return h});
