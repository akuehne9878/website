/*
 MIT license
 @version 3.1.1
*/
define(["jQuery","Modernizr"],function(e,m){function n(a,c,d){for(var b=0,e=a.length;b<e&&c.call(d,a[b],b,a)!=={};b++);}function r(a,c,b){return setTimeout(e.proxy(a,c),b)}function t(a){return e.isNumeric(a)?a:0}function B(a){var c,b,f=a.length;if(!f)return a;for(;--f;)b=Math.floor(Math.random()*(f+1)),c=a[b],a[b]=a[f],a[f]=c;return a}if("object"!==typeof m)throw Error("Shuffle.js requires Modernizr.\nhttp://vestride.github.io/Shuffle/#dependencies");var u=m.prefixed("transition"),x=m.prefixed("transitionDelay"),
v=m.prefixed("transitionDuration"),p={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[u],y=m.prefixed("transform"),C=function(a){return a?a.replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()}).replace(/^ms-/,"-ms-"):""}(y),D=m.csstransforms&&m.csstransitions,E=m.csstransforms3d,w=!!window.getComputedStyle,s=window.getComputedStyle||function(){},q=function(a,c){this.x=t(a);this.y=t(c)};q.equals=function(a,c){return a.x===c.x&&a.y===c.y};var z=function(){if(!w)return!1;var a=
document.body||document.documentElement,c=document.createElement("div");c.style.cssText="width:10px;padding:2px;-webkit-box-sizing:border-box;box-sizing:border-box;";a.appendChild(c);var b="10px"===s(c,null).width;a.removeChild(c);return b}(),F=0,A=e(window),b=function(a,c){c=c||{};e.extend(this,b.options,c,b.settings);this.$el=e(a);this.element=a;this.unique="shuffle_"+F++;this._fire(b.EventType.LOADING);this._init();r(function(){this.initialized=!0;this._fire(b.EventType.DONE)},this,16)};b.EventType=
{LOADING:"loading",DONE:"done",LAYOUT:"layout",REMOVED:"removed"};b.ClassName={BASE:"shuffle",SHUFFLE_ITEM:"shuffle-item",FILTERED:"filtered",CONCEALED:"concealed"};b.options={group:"all",speed:250,easing:"ease-out",itemSelector:"",sizer:null,gutterWidth:0,columnWidth:0,delimeter:null,buffer:0,columnThreshold:w?0.01:0.1,initialSort:null,throttle:function(a,c,b){var f,k,h,g=null,l=0;b=b||{};var n=function(){l=!1===b.leading?0:e.now();g=null;h=a.apply(f,k);f=k=null};return function(){var m=e.now();
l||!1!==b.leading||(l=m);var p=c-(m-l);f=this;k=arguments;0>=p||p>c?(clearTimeout(g),g=null,l=m,h=a.apply(f,k),f=k=null):g||!1===b.trailing||(g=setTimeout(n,p));return h}},throttleTime:300,sequentialFadeDelay:150,supported:D};b.settings={useSizer:!1,itemCss:{position:"absolute",top:0,left:0,visibility:"visible"},revealAppendedDelay:300,lastSort:{},lastFilter:"all",enabled:!0,destroyed:!1,initialized:!1,_animations:[],_transitions:[],_isMovementCanceled:!1,styleQueue:[]};b.Point=q;b._getItemTransformString=
function(a,c){return E?"translate3d("+a.x+"px, "+a.y+"px, 0) scale3d("+c+", "+c+", 1)":"translate("+a.x+"px, "+a.y+"px) scale("+c+")"};b._getNumberStyle=function(a,c,d){return w?(d=d||s(a,null),a=b._getFloat(d[c]),z||"width"!==c?z||"height"!==c||(a+=b._getFloat(d.paddingTop)+b._getFloat(d.paddingBottom)+b._getFloat(d.borderTopWidth)+b._getFloat(d.borderBottomWidth)):a+=b._getFloat(d.paddingLeft)+b._getFloat(d.paddingRight)+b._getFloat(d.borderLeftWidth)+b._getFloat(d.borderRightWidth),a):b._getFloat(e(a).css(c))};
b._getFloat=function(a){return t(parseFloat(a))};b._getOuterWidth=function(a,c){var d=s(a,null),f=b._getNumberStyle(a,"width",d);if(c)var e=b._getNumberStyle(a,"marginLeft",d),d=b._getNumberStyle(a,"marginRight",d),f=f+(e+d);return f};b._getOuterHeight=function(a,c){var d=s(a,null),f=b._getNumberStyle(a,"height",d);if(c)var e=b._getNumberStyle(a,"marginTop",d),d=b._getNumberStyle(a,"marginBottom",d),f=f+(e+d);return f};b._skipTransition=function(a,c,b){var f=a.style[v];a.style[v]="0ms";c.call(b);
a.style[v]=f};b.prototype._init=function(){this.$items=this._getItems();if(this.sizer=this._getElementOption(this.sizer))this.useSizer=!0;this.$el.addClass(b.ClassName.BASE);this._initItems();A.on("resize.shuffle."+this.unique,this._getResizeFunction());var a=this.$el.css(["position","overflow"]),c=b._getOuterWidth(this.element);this._validateStyles(a);this._setColumns(c);this.shuffle(this.group,this.initialSort);this.supported&&r(function(){this._setTransitions();this.element.style[u]="height "+
this.speed+"ms "+this.easing},this)};b.prototype._getResizeFunction=function(){var a=e.proxy(this._onResize,this);return this.throttle?this.throttle(a,this.throttleTime):a};b.prototype._getElementOption=function(a){return"string"===typeof a?this.$el.find(a)[0]||null:a&&a.nodeType&&1===a.nodeType?a:a&&a.jquery?a[0]:null};b.prototype._validateStyles=function(a){"static"===a.position&&(this.element.style.position="relative");"hidden"!==a.overflow&&(this.element.style.overflow="hidden")};b.prototype._filter=
function(a,c){a=a||this.lastFilter;c=c||this.$items;var b=this._getFilteredSets(a,c);this._toggleFilterClasses(b.filtered,b.concealed);this.lastFilter=a;"string"===typeof a&&(this.group=a);return b.filtered};b.prototype._getFilteredSets=function(a,c){var b=e(),f=e();"all"===a?b=c:n(c,function(c){c=e(c);this._doesPassFilter(a,c)?b=b.add(c):f=f.add(c)},this);return{filtered:b,concealed:f}};b.prototype._doesPassFilter=function(a,c){if(e.isFunction(a))return a.call(c[0],c,this);var b=c.data("groups"),
b=this.delimeter&&!e.isArray(b)?b.split(this.delimeter):b;return-1<e.inArray(a,b)};b.prototype._toggleFilterClasses=function(a,c){a.removeClass(b.ClassName.CONCEALED).addClass(b.ClassName.FILTERED);c.removeClass(b.ClassName.FILTERED).addClass(b.ClassName.CONCEALED)};b.prototype._initItems=function(a){a=a||this.$items;a.addClass([b.ClassName.SHUFFLE_ITEM,b.ClassName.FILTERED].join(" "));a.css(this.itemCss).data("point",new q).data("scale",1)};b.prototype._updateItemCount=function(){this.visibleItems=
this._getFilteredItems().length};b.prototype._setTransition=function(a){a.style[u]=C+" "+this.speed+"ms "+this.easing+", opacity "+this.speed+"ms "+this.easing};b.prototype._setTransitions=function(a){a=a||this.$items;n(a,function(a){this._setTransition(a)},this)};b.prototype._setSequentialDelay=function(a){this.supported&&n(a,function(a,b){a.style[x]="0ms,"+(b+1)*this.sequentialFadeDelay+"ms"},this)};b.prototype._getItems=function(){return this.$el.children(this.itemSelector)};b.prototype._getFilteredItems=
function(){return this.$items.filter("."+b.ClassName.FILTERED)};b.prototype._getConcealedItems=function(){return this.$items.filter("."+b.ClassName.CONCEALED)};b.prototype._getColumnSize=function(a,c){var d;d=e.isFunction(this.columnWidth)?this.columnWidth(a):this.useSizer?b._getOuterWidth(this.sizer):this.columnWidth?this.columnWidth:0<this.$items.length?b._getOuterWidth(this.$items[0],!0):a;0===d&&(d=a);return d+c};b.prototype._getGutterSize=function(a){return e.isFunction(this.gutterWidth)?this.gutterWidth(a):
this.useSizer?b._getNumberStyle(this.sizer,"marginLeft"):this.gutterWidth};b.prototype._setColumns=function(a){a=a||b._getOuterWidth(this.element);var c=this._getGutterSize(a),d=this._getColumnSize(a,c),c=(a+c)/d;Math.abs(Math.round(c)-c)<this.columnThreshold&&(c=Math.round(c));this.cols=Math.max(Math.floor(c),1);this.containerWidth=a;this.colWidth=d};b.prototype._setContainerSize=function(){this.$el.css("height",this._getContainerSize())};b.prototype._getContainerSize=function(){return Math.max.apply(Math,
this.positions)};b.prototype._fire=function(a,b){this.$el.trigger(a+".shuffle",b&&b.length?b:[this])};b.prototype._resetCols=function(){var a=this.cols;for(this.positions=[];a--;)this.positions.push(0)};b.prototype._layout=function(a,b){n(a,function(a){this._layoutItem(a,!!b)},this);this._processStyleQueue();this._setContainerSize()};b.prototype._layoutItem=function(a,c){var d=e(a),f=d.data(),k=f.point,h=f.scale,g={width:b._getOuterWidth(a,!0),height:b._getOuterHeight(a,!0)},g=this._getItemPosition(g);
q.equals(k,g)&&1===h||(f.point=g,f.scale=1,this.styleQueue.push({$item:d,point:g,scale:1,opacity:c?0:1,skipTransition:c||0===this.speed,callfront:function(){c||d.css("visibility","visible")},callback:function(){c&&d.css("visibility","hidden")}}))};b.prototype._getItemPosition=function(a){var b=this._getColumnSpan(a.width,this.colWidth,this.cols),d=this._getColumnSet(b,this.cols),b=this._getShortColumn(d,this.buffer),f=new q(Math.round(this.colWidth*b),Math.round(d[b]));a=d[b]+a.height;for(var d=this.cols+
1-d.length,e=0;e<d;e++)this.positions[b+e]=a;return f};b.prototype._getColumnSpan=function(a,b,d){a/=b;Math.abs(Math.round(a)-a)<this.columnThreshold&&(a=Math.round(a));return Math.min(Math.ceil(a),d)};b.prototype._getColumnSet=function(a,b){if(1===a)return this.positions;for(var d=b+1-a,f=[],e=0;e<d;e++){var h=f,g=e,l;l=this.positions.slice(e,e+a);l=Math.max.apply(Math,l);h[g]=l}return f};b.prototype._getShortColumn=function(a,b){for(var d=Math.min.apply(Math,a),f=0,e=a.length;f<e;f++)if(a[f]>=d-
b&&a[f]<=d+b)return f;return 0};b.prototype._shrink=function(a){a=a||this._getConcealedItems();n(a,function(a){var b=e(a);a=b.data();0.001!==a.scale&&(a.scale=0.001,this.styleQueue.push({$item:b,point:a.point,scale:0.001,opacity:0,callback:function(){b.css("visibility","hidden")}}))},this)};b.prototype._onResize=function(){this.enabled&&!this.destroyed&&b._getOuterWidth(this.element)!==this.containerWidth&&this.update()};b.prototype._getStylesForTransition=function(a){var c={opacity:a.opacity};this.supported?
c[y]=b._getItemTransformString(a.point,a.scale):(c.left=a.point.x,c.top=a.point.y);return c};b.prototype._transition=function(a){var b=this._getStylesForTransition(a);this._startItemAnimation(a.$item,b,a.callfront||e.noop,a.callback||e.noop)};b.prototype._startItemAnimation=function(a,b,d,f){function k(a){a.target===a.currentTarget&&(e(a.target).off(p,k),h._removeTransitionReference(g),f())}var h=this,g={$element:a,handler:k};d();this.initialized?this.supported?(a.css(b),a.on(p,k),this._transitions.push(g)):
(a=a.stop(!0).animate(b,this.speed,"swing",f),this._animations.push(a.promise())):(a.css(b),f())};b.prototype._processStyleQueue=function(a){this.isTransitioning&&this._cancelMovement();var b=e();n(this.styleQueue,function(a){a.skipTransition?this._styleImmediately(a):(b=b.add(a.$item),this._transition(a))},this);0<b.length&&this.initialized&&0<this.speed?(this.isTransitioning=!0,this.supported?this._whenCollectionDone(b,p,this._movementFinished):this._whenAnimationsDone(this._movementFinished)):
a||r(this._layoutEnd,this);this.styleQueue.length=0};b.prototype._cancelMovement=function(){this.supported?n(this._transitions,function(a){a.$element.off(p,a.handler)}):(this._isMovementCanceled=!0,this.$items.stop(!0),this._isMovementCanceled=!1);this._transitions.length=0;this.isTransitioning=!1};b.prototype._removeTransitionReference=function(a){a=e.inArray(a,this._transitions);-1<a&&this._transitions.splice(a,1)};b.prototype._styleImmediately=function(a){b._skipTransition(a.$item[0],function(){a.$item.css(this._getStylesForTransition(a))},
this)};b.prototype._movementFinished=function(){this.isTransitioning=!1;this._layoutEnd()};b.prototype._layoutEnd=function(){this._fire(b.EventType.LAYOUT)};b.prototype._addItems=function(a,b,d){this._initItems(a);this._setTransitions(a);this.$items=this._getItems();this._shrink(a);n(this.styleQueue,function(a){a.skipTransition=!0});this._processStyleQueue(!0);b?this._addItemsToEnd(a,d):this.shuffle(this.lastFilter)};b.prototype._addItemsToEnd=function(a,b){var d=this._filter(null,a).get();this._updateItemCount();
this._layout(d,!0);b&&this.supported&&this._setSequentialDelay(d);this._revealAppended(d)};b.prototype._revealAppended=function(a){r(function(){n(a,function(a){a=e(a);this._transition({$item:a,opacity:1,point:a.data("point"),scale:1})},this);this._whenCollectionDone(e(a),p,function(){e(a).css(x,"0ms");this._movementFinished()})},this,this.revealAppendedDelay)};b.prototype._whenCollectionDone=function(a,b,d){function f(a){a.target===a.currentTarget&&(e(a.target).off(b,f),k++,k===h&&(g._removeTransitionReference(l),
d.call(g)))}var k=0,h=a.length,g=this,l={$element:a,handler:f};a.on(b,f);this._transitions.push(l)};b.prototype._whenAnimationsDone=function(a){e.when.apply(null,this._animations).always(e.proxy(function(){this._animations.length=0;this._isMovementCanceled||a.call(this)},this))};b.prototype.shuffle=function(a,b){this.enabled&&(a||(a="all"),this._filter(a),this._updateItemCount(),this._shrink(),this.sort(b))};b.prototype.sort=function(a){if(this.enabled){this._resetCols();a=a||this.lastSort;var b=
this._getFilteredItems().sorted(a);this._layout(b);this.lastSort=a}};b.prototype.update=function(a){this.enabled&&(a||this._setColumns(),this.sort())};b.prototype.layout=function(){this.update(!0)};b.prototype.appended=function(a,b,d){this._addItems(a,!0===b,!1!==d)};b.prototype.disable=function(){this.enabled=!1};b.prototype.enable=function(a){this.enabled=!0;!1!==a&&this.update()};b.prototype.remove=function(a){function c(){a.remove();this.$items=this._getItems();this._updateItemCount();this._fire(b.EventType.REMOVED,
[a,this]);a=null}a.length&&a.jquery&&(this._toggleFilterClasses(e(),a),this._shrink(a),this.sort(),this.$el.one(b.EventType.LAYOUT+".shuffle",e.proxy(c,this)))};b.prototype.destroy=function(){A.off("."+this.unique);this.$el.removeClass("shuffle").removeAttr("style").removeData("shuffle");this.$items.removeAttr("style").removeData("point").removeData("scale").removeClass([b.ClassName.CONCEALED,b.ClassName.FILTERED,b.ClassName.SHUFFLE_ITEM].join(" "));this._transitions=this.element=this.sizer=this.$el=
this.$items=null;this.destroyed=!0};e.fn.shuffle=function(a){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=e(this),f=d.data("shuffle");f?"string"===typeof a&&f[a]&&f[a].apply(f,c):(f=new b(this,a),d.data("shuffle",f))})};e.fn.sorted=function(a){var b=e.extend({},e.fn.sorted.defaults,a);a=this.get();var d=!1;if(!a.length)return[];if(b.randomize)return B(a);e.isFunction(b.by)&&a.sort(function(a,k){if(d)return 0;var h=b.by(e(a)),g=b.by(e(k));return void 0===h&&void 0===
g?(d=!0,0):h<g||"sortFirst"===h||"sortLast"===g?-1:h>g||"sortLast"===h||"sortFirst"===g?1:0});if(d)return this.get();b.reverse&&a.reverse();return a};e.fn.sorted.defaults={reverse:!1,by:null,randomize:!1};return b});
